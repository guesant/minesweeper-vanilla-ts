function t(t){return t&&t.__esModule?t.default:t}var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{};const s=(t,e,s)=>{const i=Array.isArray(s)?s:[s],l=new Set;for(;l.size!==t;){const t=Math.floor(Math.random()*e);i.includes(t)||l.add(t)}return Array.from(l)};class i{constructor(t,e={}){this.game=t,this.rootEl=document.createElement("div");const{className:s}=e;s&&this.rootEl.classList.add(s)}handleGameStart(){}}const l=t=>String(t).padStart(3,"0");let n;var o;(o=n||(n={}))[o.STOPPED=1]="STOPPED",o[o.RUNNING=2]="RUNNING",o[o.LOSE=4]="LOSE",o[o.WIN=8]="WIN";class r extends i{get unknownBombs(){return Math.max(this.game.bombsCount-this.game.flagsCount,0)}get statusEmoji(){const{status:t}=this.game;return t&n.LOSE?"ðŸ˜µ":t&n.WIN?"ðŸ˜Ž":"ðŸ™‚"}get elapsedTime(){return this.game.timer.elapsedTime}constructor(t){super(t,{className:"KvB8Hq_gameHeader"}),this.rootEl.innerHTML='\n      <div data-panel="left">\n        <span data-counter="bombs"></span>\n      </div>\n      <div data-panel="center">\n        <button data-button="status"></button>\n      </div>\n      <div data-panel="right">\n        <span data-counter="timer"></span>\n      </div>\n    ',this.bombsCounterEl=this.rootEl.querySelector('[data-counter="bombs"]'),this.btnStatusEl=this.rootEl.querySelector('[data-button="status"]'),this.timerCounterEl=this.rootEl.querySelector('[data-counter="timer"]'),this.game.timer.listeners.add((()=>this.render())),this.btnStatusEl.addEventListener("click",(()=>this.game.restart())),this.game.rootEl.appendChild(this.rootEl)}render(){this.bombsCounterEl.textContent=l(this.unknownBombs),this.btnStatusEl.textContent=this.statusEmoji,this.timerCounterEl.textContent=l(this.elapsedTime)}}let a;var h;(h=a||(a={}))[h.BOMB=1]="BOMB",h[h.FLAG=2]="FLAG",h[h.OPENED=4]="OPENED",h[h.BOMB_CLICK=8]="BOMB_CLICK";const u=(t,e)=>t.row*e+t.col,c=(t,e)=>({row:Math.floor(t/e),col:t%e}),d=(t,e,s)=>{const{col:i,row:l}=c(t,e);return[[-1,-1,l>0&&i>0],[-1,0,l>0],[-1,1,l>0&&i<e-1],[0,-1,i>0],[0,1,i<e-1],[1,-1,l<s-1&&i>0],[1,0,l<s-1],[1,1,l<s-1&&i<e-1]].filter((([,,t])=>t)).map((([t,e])=>[l+t,i+e])).map((([t,s])=>u({col:s,row:t},e)))};class m extends i{get col(){return this.index%this.game.cols}get row(){return Math.floor(this.index/this.game.cols)}get tableCells(){return this.game.table.tableCells}get tableCell(){return this.tableCells[this.index]}get cellStatus(){return this.game.cells[this.index]}set cellStatus(t){this.game.cells[this.index]=t}get aroundCellsWithFlags(){return this.aroundPositions.filter((t=>this.game.cells[t]&a.FLAG))}get aroundCellsWithBombs(){return this.aroundPositions.filter((t=>this.game.cells[t]&a.BOMB))}get aroundCellsWithBombsCount(){return this.cellStatus&a.BOMB?-1:this.aroundCellsWithBombs.length}constructor(t,e){super(t.game,{className:"_29Z9hG_gameTableCell"}),this.index=e,this.handleClick=()=>{if(!this.game.table.canTouchTable)return;let t=!1;if(0===this.game.distributedBombsCount&&this.game.initialBombsDistribution(this.index),this.cellStatus&a.FLAG)return;const e=new Set;e.add(this.index);const s=new Set,{aroundCellsWithBombsCount:i}=this;if(0===i&&s.add(this.index),this.cellStatus&a.OPENED){const{aroundCellsWithFlags:t}=this;if(t.length>0&&t.length===i){const i=this.aroundPositions.filter((e=>!t.includes(e)));for(const t of i)e.add(t),0===this.tableCells[t].aroundCellsWithBombsCount&&s.add(t)}}const{safeCellsAlreadyChecked:l}=this.game.table;for(;s.size>0;){const t=s.values().next().value;if(!l.has(t)){const{aroundPositions:i}=this.tableCells[t];i.forEach((t=>e.add(t))),i.filter((t=>!l.has(t)&&!s.has(t))).filter((t=>0===this.tableCells[t].aroundCellsWithBombsCount)).forEach((t=>s.add(t))),l.add(t)}s.delete(t)}for(const s of e){const e=this.tableCells[s];e.cellStatus&a.OPENED||(e.cellStatus|=a.OPENED),!t&&e.cellStatus&a.BOMB&&null===this.game.bombClickIndex&&(e.cellStatus|=a.BOMB_CLICK,t=!0)}t&&console.log("bomb click!",this.game.bombClickIndex),this.game.render()},this.handleRightClick=()=>{this.game.table.canTouchTable&&(this.cellStatus&a.OPENED||(this.cellStatus^=a.FLAG,this.game.render()))},this.#t=null,this.rootEl.addEventListener("click",this.handleClick),this.rootEl.addEventListener("contextmenu",this.handleRightClick),t.rootEl.appendChild(this.rootEl),this.aroundPositions=d(this.index,this.game.cols,this.game.rows)}dispose(){this.game.table.rootEl.removeChild(this.rootEl),this.rootEl.removeEventListener("click",this.handleClick),this.rootEl.removeEventListener("contextmenu",this.handleRightClick)}#t;get shouldRender(){return this.#t!==this.cellStatus}render(){if(!this.shouldRender)return;let t=!1;if(this.cellStatus&a.BOMB&&this.cellStatus&a.OPENED?this.rootEl.dataset.bomb=this.game.bombClickIndex===this.index?"click":"":delete this.rootEl.dataset.bomb,this.cellStatus&a.OPENED){this.rootEl.dataset.opened="",this.rootEl.innerText="";const{aroundCellsWithBombsCount:t}=this;t>0&&(this.rootEl.innerText=`${t}`)}else delete this.rootEl.dataset.opened,t=Boolean(this.cellStatus&a.FLAG),this.rootEl.innerText="";t?this.rootEl.dataset.flag="":delete this.rootEl.dataset.flag,this.#t=this.cellStatus}}class b extends i{tableCells=[];safeCellsAlreadyChecked=new Set;get canTouchTable(){const{status:t}=this.game;return Boolean(t&n.RUNNING|t&n.STOPPED)}constructor(t){super(t,{className:"_29Z9hG_gameTable"}),this.game.rootEl.appendChild(this.rootEl)}render(){this.canTouchTable?delete this.rootEl.dataset.canNotTouch:this.rootEl.dataset.canNotTouch="";const t=this.tableCells.filter((t=>t.shouldRender));for(const e of t)e.render()}handleGameStart(){this.safeCellsAlreadyChecked.clear();for(const t of this.tableCells)t.dispose();this.tableCells=this.game.cells.map(((t,e)=>new m(this,e)))}}class f{#e=0;#s=null;listeners=new Set;get elapsedTime(){return this.#e}set elapsedTime(t){this.#e=t,requestIdleCallback((()=>this.runListeners()),{timeout:10})}get isRunning(){return null!==this.#s}runListeners(){for(const t of this.listeners)t()}start(){this.stop(),this.#s=setInterval((()=>{this.elapsedTime++}),1e3)}stop(){null!==this.#s&&(clearInterval(this.#s),this.#s=null)}reset(){this.stop(),this.elapsedTime=0}restart(){this.reset(),this.start()}}const g=t=>({hasFlag:Boolean(t&a.FLAG),hasBomb:Boolean(t&a.BOMB),isOpened:Boolean(t&a.OPENED),hasBombClicked:Boolean(t&a.BOMB_CLICK)});const C=document.querySelector("#game"),p=new class{#i;get cells(){return this.#i}set cells(t){const e=t=>{this.computeCellsCounter(t),this.checkGameStatus()};var s,i;this.#i=(s=t,i=t=>e(t),new Proxy(Array.from(s),{set(t,e,s){if("symbol"!=typeof e){const l=parseInt(e);if(!Number.isNaN(l)){const e=t[l];return t[l]=s,e!==s&&i({idx:l,prevValue:e,nextValue:s}),!0}}return e in t&&(t[e]=s,!0)}})),e()}get cellsCount(){return this.cols*this.rows}get status(){return this.bombClickIndex?n.LOSE:this.cellsClosedCount===this.bombsCount?n.WIN:this.timer.isRunning?n.RUNNING:n.STOPPED}get flagsCount(){return this.cellsCounter.flags}get bombClickIndex(){return this.cellsCounter.bombClickIndex}get distributedBombsCount(){return this.cellsCounter.distributedBombs}get cellsOpenedCount(){return this.cellsCounter.cellsOpened}get cellsClosedCount(){return this.cellsCount-this.cellsOpenedCount}computeCellsCounter(t){if(t){const{idx:e,prevValue:s,nextValue:i}=t;if(s===i)return;const l=this.cellsCounter,n=g(s);l.flags-=Number(n.hasFlag),l.cellsOpened-=Number(n.isOpened),l.distributedBombs-=Number(n.hasBomb),n.hasBombClicked&&e===l.bombClickIndex&&(l.bombClickIndex=null);const o=g(i);l.flags+=Number(o.hasFlag),l.cellsOpened+=Number(o.isOpened),l.distributedBombs+=Number(o.hasBomb),o.hasBombClicked&&(l.bombClickIndex=e),this.cellsCounter=l}else this.cellsCounter=this.cells.reduce(((t,e,s)=>{const{hasBomb:i,hasBombClicked:l,hasFlag:n,isOpened:o}=g(e);return t.flags+=Number(n),t.cellsOpened+=Number(o),t.distributedBombs+=Number(i),l&&(t.bombClickIndex=s),t}),{flags:0,distributedBombs:0,bombClickIndex:null,cellsOpened:0})}constructor(t){this.rootEl=t,this.cols=0,this.rows=0,this.bombsCount=0,this.#i=[],this.cellsCounter={flags:0,distributedBombs:0,bombClickIndex:null,cellsOpened:0},this.timer=new f,this.table=new b(this),this.header=new r(this),this.rootEl.classList.add("R8TdLa_game"),this.rootEl.addEventListener("contextmenu",(t=>t.preventDefault()))}checkGameStatus(){const{status:t}=this;(t&n.WIN||t&n.LOSE)&&this.timer.stop()}start(t,e,s){if(s>=t*e)throw new Error("Invalid game setup!");return this.timer.reset(),this.cols=t,this.rows=e,this.bombsCount=s,this.cells=Array(this.cellsCount).fill(0),this.header.handleGameStart(),this.table.handleGameStart(),this.render(),this}restart(){this.start(this.cols,this.rows,this.bombsCount)}render(){return this.rootEl.style.setProperty("--game-table-cols",String(this.cols)),this.rootEl.style.setProperty("--game-table-rows",String(this.rows)),this.header.render(),this.table.render(),this}distributeRandomBombs(t){const e=s(this.bombsCount,this.cellsCount,t);for(let t=0;t<this.cellsCount;t++)e.includes(t)?this.cells[t]|=a.BOMB:this.cells[t]=this.cells[t]&~a.BOMB;return this}initialBombsDistribution(t){this.distributeRandomBombs(t),this.timer.start()}}(C);Object.assign(window,{game:p});var E=/^\s+|\s+$/g,v=/^[-+]0x[0-9a-f]+$/i,B=/^0b[01]+$/i,S=/^0o[0-7]+$/i,O=parseInt,x="object"==typeof e&&e&&e.Object===Object&&e,N="object"==typeof self&&self&&self.Object===Object&&self,y=x||N||Function("return this")(),w=Object.prototype.toString,T=Math.max,I=Math.min,k=function(){return y.Date.now()};function L(t,e,s){var i,l,n,o,r,a,h=0,u=!1,c=!1,d=!0;if("function"!=typeof t)throw new TypeError("Expected a function");function m(e){var s=i,n=l;return i=l=void 0,h=e,o=t.apply(n,s)}function b(t){return h=t,r=setTimeout(g,e),u?m(t):o}function f(t){var s=t-a;return void 0===a||s>=e||s<0||c&&t-h>=n}function g(){var t=k();if(f(t))return C(t);r=setTimeout(g,function(t){var s=e-(t-a);return c?I(s,n-(t-h)):s}(t))}function C(t){return r=void 0,d&&i?m(t):(i=l=void 0,o)}function p(){var t=k(),s=f(t);if(i=arguments,l=this,a=t,s){if(void 0===r)return b(a);if(c)return r=setTimeout(g,e),m(a)}return void 0===r&&(r=setTimeout(g,e)),o}return e=M(e)||0,P(s)&&(u=!!s.leading,n=(c="maxWait"in s)?T(M(s.maxWait)||0,e):n,d="trailing"in s?!!s.trailing:d),p.cancel=function(){void 0!==r&&clearTimeout(r),h=0,i=a=l=r=void 0},p.flush=function(){return void 0===r?o:C(k())},p}function P(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function M(t){if("number"==typeof t)return t;if(function(t){return"symbol"==typeof t||function(t){return!!t&&"object"==typeof t}(t)&&"[object Symbol]"==w.call(t)}(t))return NaN;if(P(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=P(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(E,"");var s=B.test(t);return s||S.test(t)?O(t.slice(2),s?2:8):v.test(t)?NaN:+t}const G=t((function(t,e,s){var i=!0,l=!0;if("function"!=typeof t)throw new TypeError("Expected a function");return P(s)&&(i="leading"in s?!!s.leading:i,l="trailing"in s?!!s.trailing:l),L(t,e,{leading:i,maxWait:e,trailing:l})}))((()=>(()=>{const t=Math.min(...[[document.body.offsetHeight,C.offsetHeight],[document.body.offsetWidth,C.offsetWidth]].map((([t,e])=>(t-40)/e)));C.style.setProperty("transform",`scale(${t})`)})()),10);p.start(9,9,10),window.addEventListener("resize",G),G();